<!-- Naudojame layout.html -->
<div th:fragment="main-content" xmlns:th="http://www.w3.org/1999/xhtml">

    <div th:switch="${view}">

        <!-- OVERVIEW -->
        <div th:case="'overview'">
            <h2 th:text="'Bendrija: ' + ${community.name}">Mano bendrijos statistika</h2>

            <div class="cards">
                <div class="card">
                    <h3>Gyventojų</h3>
                    <div class="number" th:text="${residentsCount}">0</div>
                </div>
                <div class="card">
                    <h3>Paslaugų</h3>
                    <div class="number" th:text="${feesCount}">0</div>
                </div>
                <div class="card">
                    <h3>Kainų</h3>
                    <div class="number" th:text="${pricesCount}">0</div>
                </div>
            </div>

            <div class="overview-note">
                <p>Vadybininkas gali administruoti tik savo bendrijos duomenis — vartotojus, paslaugas ir kainas.</p>
            </div>
        </div>

        <!-- RESIDENTS -->
        <div th:case="'residents'">
            <h2>Gyventojai</h2>
            <button class="add-btn" onclick="openModal('add-user')">+ Naujas gyventojas</button>

            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Vardas</th>
                    <th>El. paštas</th>
                    <th>Rolė</th>
                    <th>Veiksmai</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="u : ${residents}">
                    <td th:text="${u.id}"></td>
                    <td th:text="${u.name}"></td>
                    <td th:text="${u.email}"></td>
                    <td th:text="${u.role.name}"></td>
                    <td class="actions">
                        <button class="edit"
                                th:attr="data-id=${u.id},
                                         data-name=${u.name},
                                         data-email=${u.email},
                                         data-role=${u.role.name},
                                         data-communitycode=${community.code}"
                                onclick="openEditUser(this)">
                            Redaguoti
                        </button>
                        <button class="delete"
                                th:onclick="|openModal('confirm-delete', {url: '@{/users/{id}(id=${u.id})}'})|">
                            Trinti
                        </button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(residents)}">
                    <td colspan="5" style="text-align:center; color:#888;">Nėra registruotų gyventojų.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- FEES -->
        <div th:case="'fees'">
            <h2>Paslaugos</h2>
            <button class="add-btn" onclick="openModal('add-fee')">+ Nauja paslauga</button>

            <table>
                <thead>
                <tr>
                    <th>Pavadinimas</th>
                    <th>Matavimo vnt.</th>
                    <th>Aprašymas</th>
                    <th>Veiksmai</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="f : ${fees}">
                    <td th:text="${f.name}"></td>
                    <td th:text="${f.unit}"></td>
                    <td th:text="${f.description}"></td>
                    <td class="actions">
                        <button class="edit"
                                th:attr="data-id=${f.id},
                                         data-name=${f.name},
                                         data-unit=${f.unit},
                                         data-description=${f.description},
                                         data-communityid=${community.id}"
                                onclick="openEditFee(this)">
                            Redaguoti
                        </button>
                        <button class="delete"
                                th:onclick="|openModal('confirm-delete', {url: '@{/fees/{id}(id=${f.id})}'})|">
                            Trinti
                        </button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(fees)}">
                    <td colspan="4" style="text-align:center; color:#888;">Nėra sukurtų paslaugų.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- PRICES -->
        <div th:case="'prices'">
            <h2>Kainos</h2>

            <button class="add-btn" onclick="openModal('add-price')">+ Nauja kaina</button>

            <table>
                <thead>
                <tr>
                    <th>Paslauga</th>
                    <th>Bendrija</th>
                    <th>Kaina (€)</th>
                    <th>Galioja nuo</th>
                    <th>Galioja iki</th>
                    <th>Veiksmai</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${prices}">
                    <td th:text="${p.fee.name}"></td>
                    <td th:text="${p.community.name}"></td>
                    <td th:text="${#numbers.formatDecimal(p.amount, 1, 2)}"></td>
                    <td th:text="${#temporals.format(p.validFrom, 'yyyy-MM-dd')}"></td>
                    <td th:text="${p.validTo != null ? #temporals.format(p.validTo, 'yyyy-MM-dd') : '-'}"></td>

                    <td class="actions">
                        <button class="edit"
                                th:attr="data-id=${p.id},
                                 data-feeid=${p.fee.id},
                                 data-communityid=${p.community.id},
                                 data-amount=${p.amount},
                                 data-validfrom=${p.validFrom},
                                 data-validto=${p.validTo}"
                                onclick="openEditPrice(this)">
                            Redaguoti
                        </button>
                        <button class="delete"
                                th:onclick="|openModal('confirm-delete', {url: '@{/prices/{id}(id=${p.id})}'})|">
                            Trinti
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>


    </div>
</div>
